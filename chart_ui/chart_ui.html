<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>ES Chart Pro (v5.0)</title>
    <!-- Import Map for ES6 Module Plugins -->
    <script type="importmap">
    {
        "imports": {
            "lightweight-charts": "https://unpkg.com/lightweight-charts/dist/lightweight-charts.standalone.production.mjs"
        }
    }
    </script>
    <!-- Lightweight Charts v5.0 - ES Module with global exposure -->
    <script type="module">
        import * as LightweightCharts from 'lightweight-charts';
        window.LightweightCharts = LightweightCharts;
        window.dispatchEvent(new Event('lightweightChartsReady'));
    </script>
    <script src="indicator_manager.js"></script>
    <script src="trendline_plugin.js"></script>
    <script src="rectangle_plugin.js"></script>
    <script src="fibonacci_plugin.js"></script>
    <script src="vertical_line_plugin.js"></script>
    <script src="anchored_text_plugin.js"></script>
    <!-- CSS -->
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/toolbar.css">
    <link rel="stylesheet" href="css/sidebar.css">
    <link rel="stylesheet" href="css/modal.css">
    </style>
</head>

<body>
    <!-- Left Sidebar -->
    <div id="drawing-sidebar">
        <button class="tool-btn" id="btn-line" onclick="setTool('line')" title="Line">üìè</button>
        <button class="tool-btn" id="btn-ray" onclick="setTool('ray')" title="Trend Line">üìâ</button>
        <button class="tool-btn" id="btn-rect" onclick="setTool('rect')" title="Rectangle">‚ñ≠</button>
        <button class="tool-btn" id="btn-fib" onclick="setTool('fib')" title="Fibonacci">üî¢</button>
        <button class="tool-btn" id="btn-vert" onclick="setTool('vert')" title="Vertical Line">‚îÇ</button>
        <button class="tool-btn" id="btn-text" onclick="addWatermark()" title="Text">T</button>
        
        <div class="tool-separator"></div>
        
        <button class="tool-btn delete" onclick="clearDrawings()" title="Clear All">üóë</button>
    </div>

    <div id="header">
        <div class="toolbar-group">
            <!-- Ticker -->
            <select id="ticker">
                <option value="ES1" selected>ES1</option>
                <option value="NQ1">NQ1</option>
            </select>

            <div class="divider"></div>

            <!-- Timeframe Buttons -->
            <div id="tf-buttons" style="display: flex; gap: 2px;">
                <button onclick="changeTimeframe('1m')" data-tf="1m">1m</button>
                <button onclick="changeTimeframe('5m')" data-tf="5m">5m</button>
                <button onclick="changeTimeframe('15m')" data-tf="15m">15m</button>
                <button onclick="changeTimeframe('1h')" class="active" data-tf="1h">1h</button>
                <button onclick="changeTimeframe('4h')" data-tf="4h">4h</button>
                <button onclick="changeTimeframe('1D')" data-tf="1D">1D</button>
            </div>

            <!-- Custom Timeframe -->
            <input type="text" id="custom-tf" placeholder="Custom" style="width: 60px; text-align: center;"
                onchange="changeTimeframe(this.value)" title="Enter custom timeframe (e.g. 45m, 2D)">

            <!-- More Timeframes Dropdown -->
            <select id="more-timeframes" onchange="changeTimeframe(this.value)" style="width: 20px; padding: 0;"
                title="More Timeframes">
                <option value="" disabled selected>‚ñº</option>
                <!-- Populated by JS -->
            </select>

            <div class="divider"></div>

            <!-- Drawing Tools Moved to Sidebar -->

            

            

            
            <!-- Indicators & Strategy -->
            <button onclick="openIndicatorsModal()">üìä Indicators</button>
            <button id="strategyBtn" onclick="toggleStrategy()">‚ö° Strategy</button>

        </div>

        <div class="toolbar-group">
            <!-- Navigation -->
            <input type="date" id="datePicker">
            <button onclick="jumpToDate()">Go</button>

            <div class="divider"></div>

            <!-- Timezone -->
            <select id="timezone">
                <option value="America/New_York" selected>NY (EST)</option>
                <option value="America/Chicago">Chicago (CST)</option>
                <option value="America/Los_Angeles">LA (PST)</option>
                <option value="UTC">UTC</option>
                <option value="Europe/London">London</option>
            </select>

            <div class="divider"></div>
            <!-- Plugin Manager -->
        <div id="plugin-manager" style="position: absolute; top: 60px; right: 10px; background: rgba(42, 46, 57, 0.95); border: 1px solid #4a4e59; border-radius: 4px; padding: 10px; width: 250px; max-height: 400px; overflow-y: auto; display: none;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; border-bottom: 1px solid #4a4e59; padding-bottom: 8px;">
                <h3 style="margin: 0; font-size: 14px; color: #d1d4dc;">Active Plugins</h3>
                <button onclick="clearAllPlugins()" style="background: #d32f2f; color: white; border: none; padding: 4px 8px; border-radius: 3px; cursor: pointer; font-size: 11px;">Clear All</button>
            </div>
            <div id="plugin-list">
                <div style="color: #888; font-size: 12px; padding: 10px; text-align: center;">No plugins loaded</div>
            </div>
        </div>
        <button id="toggle-plugin-manager" onclick="togglePluginManager()" style="position: absolute; top: 65px; right: 10px; background: #2962FF; color: white; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer; font-size: 12px; z-index: 100;">
            üìã Plugins (<span id="plugin-count">0</span>)
        </button>

        <div id="status">Loading...</div>
        </div>
    </div>

    <div id="chart-container">
        <div id="chart"></div>
        <div id="indicator-container" style="flex: 0 0 auto;"></div>
    </div>

    
    <!-- Indicators Modal -->
    <div id="indicators-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Indicators & Plugins</div>
                <button class="modal-close" onclick="closeIndicatorsModal()">√ó</button>
            </div>
            <div class="modal-body">
                <div class="modal-sidebar" id="modal-categories">
                    <!-- Categories populated by JS -->
                </div>
                <div class="modal-main">
                    <div class="search-container">
                        <input type="text" id="indicator-search" class="search-input" placeholder="Search indicators...">
                    </div>
                    <div class="items-grid" id="modal-items">
                        <!-- Items populated by JS -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Application Module -->
    <script type="module" src="js/main.js"></script>
</body>

</html>